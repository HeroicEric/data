parameters:
  nodeVersion: '10.x'
  partner: ''
  allowedToFail: false

steps:
  - template: 'setup-environment.yml'

  - script: yarn
    displayName: 'Yarn install'

  - script: node ./bin/packages-for-commit.js
    displayName: 'Generate package tarballs'

  - ${{ if eq(parameters.allowedToFail, 'true') }}:
    - script: |
        CI=true yarn test-external:${{ parameters.partner }}
        exit 0
      displayName: 'External: ${{ parameters.partner }} allowed-to-fail'

  - ${{ if not(eq(parameters.allowedToFail, 'true')) }}:
    - script: CI=true yarn test-external:${{ parameters.partner }}
      displayName: 'External: ${{ parameters.partner }}'
